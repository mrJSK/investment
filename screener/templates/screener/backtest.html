{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Backtest - {{ scan.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-dark text-light">
<div class="container py-4">
    <h1 class="mb-4">Backtest: {{ scan.name }}</h1>
    <div class="row mb-4">
        <div class="col-md-3">Total Trades: {{ stats.total_trades }}</div>
        <div class="col-md-3">Win Rate: {{ stats.win_rate }}%</div>
        <div class="col-md-3">Avg Return: {{ stats.avg_return }}%</div>
        <div class="col-md-3">Cumulative Return: {{ stats.cumulative_return }}%</div>
    </div>
    <canvas id="equityChart" height="100"></canvas>
    <hr class="my-4"/>
    <table class="table table-dark table-striped table-sm">
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Entry Date</th>
                <th>Entry Price</th>
                <th>Exit Date</th>
                <th>Exit Price</th>
                <th>Return %</th>
            </tr>
        </thead>
        <tbody>
        {% for t in trades %}
            <tr>
                <td>{{ t.symbol }}</td>
                <td>{{ t.entry_date }}</td>
                <td>{{ t.entry_price }}</td>
                <td>{{ t.exit_date }}</td>
                <td>{{ t.exit_price }}</td>
                <td>{{ t.pct_return }}%</td>
            </tr>
        {% empty %}
            <tr><td colspan="6" class="text-center">No trades</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<script>
const equityData = {{ stats.equity_curve|safe }};
const ctx = document.getElementById('equityChart').getContext('2d');
const labels = equityData.map(p => p.date);
const data = equityData.map(p => p.equity);
new Chart(ctx, {
    type: 'line',
    data: { labels: labels, datasets:[{ label:'Equity', data:data, borderColor:'#4e79a7', fill:false }] },
    options: { scales:{ x:{ display:true }, y:{ display:true } } }
});
</script>
</body>
</html>
