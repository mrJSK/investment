<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ScreenerX ‚Äì Advanced Stock Screener</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f7f9fc;
      }
      .navbar-brand {
        font-weight: bold;
        letter-spacing: 1px;
      }
      .filter-card,
      .card {
        border-radius: 16px;
      }
      .filter-card {
        margin-bottom: 12px;
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.04);
      }
      .action-bar .btn {
        min-width: 150px;
        font-weight: 500;
        font-size: 1rem;
      }
      .filter-index {
        font-size: 0.93em;
        color: #888;
        background: #ececec;
        border-radius: 3px;
        padding: 1px 5px;
        margin-right: 3px;
      }
      .metric {
        font-weight: 600;
        color: #212529;
        cursor: pointer;
        background: #e6edff;
        padding: 2px 8px;
        border-radius: 5px;
      }
      .condition {
        color: #994cff;
        font-weight: 600;
      }
      .operator {
        color: #0a58ca;
        font-weight: bold;
      }
      .icon-btn {
        border: none;
        background: none;
        color: #5e5e5e;
        margin-left: 5px;
      }
      .icon-btn:hover {
        color: #994cff;
      }
      .table thead {
        background: #ebeff4;
      }
      .table-hover tbody tr:hover {
        background: #faf4ff;
      }
      .badge-buy {
        background: #3adb76 !important;
      }
      .segment-dropdown {
        font-weight: 600;
      }
      .sidebar {
        background: #fff;
        border-radius: 12px;
        padding: 18px 15px;
        box-shadow: 0 1px 10px rgba(0, 0, 0, 0.05);
      }
      .sidebar label {
        margin-top: 12px;
        font-size: 0.97rem;
      }
      .floating-btn {
        position: fixed;
        right: 32px;
        bottom: 32px;
        z-index: 1030;
        background: #994cff;
        color: #fff;
        border-radius: 50%;
        width: 58px;
        height: 58px;
        font-size: 2.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 5px 12px rgba(153, 76, 255, 0.2);
        border: none;
      }
      .floating-btn:hover {
        background: #7b35e2;
      }
      .form-switch .form-check-input {
        cursor: pointer;
      }
      @media (max-width: 991px) {
        .sidebar {
          margin-bottom: 18px;
        }
        .action-bar .btn {
          min-width: 120px;
          font-size: 0.95rem;
        }
      }
      @media (max-width: 600px) {
        .sidebar {
          padding: 12px 6px;
        }
        .navbar-brand {
          font-size: 1.1rem;
        }
        .action-bar .btn {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg navbar-light bg-white border-bottom mb-3"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="#">üìä ScreenerX</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav align-items-center">
            <li class="nav-item"><a class="nav-link" href="#">Dashboard</a></li>
            <li class="nav-item">
              <a class="nav-link" href="#">Create Alert</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="ml_trainer.html">ML Trainer</a>
            </li>
            <li class="nav-item"><a class="nav-link" href="#">Login</a></li>
            <li class="nav-item ps-2">
              <div class="form-check form-switch mb-0">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="darkSwitch"
                />
                <label class="form-check-label" for="darkSwitch">üåô</label>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid" style="max-width: 1140px">
      <div class="row">
        <!-- Sidebar filters -->
        <div class="col-lg-3 mb-3">
          <div class="sidebar">
            <h6 class="mb-2">üîç Quick Filters</h6>
            <label>Market Cap</label>
            <select class="form-select mb-2">
              <option>All</option>
              <option>Large Cap</option>
              <option>Mid Cap</option>
              <option>Small Cap</option>
            </select>
            <label>Sector</label>
            <select class="form-select mb-2">
              <option>All</option>
              <option>IT</option>
              <option>Finance</option>
              <option>Energy</option>
            </select>
            <label>Volume</label>
            <input
              type="range"
              class="form-range"
              min="0"
              max="100"
              value="30"
            />
          </div>
        </div>
        <div class="col-lg-9">
          <!-- Screener summary -->
          <div class="mb-2 small">
            Stock passes <b>all</b> of the below filters in
            <select
              class="segment-dropdown border-0 bg-transparent text-primary"
            >
              <option>Nifty 50</option>
              <option>Nifty 100</option>
              <option>Nifty 500</option>
              <option>All NSE</option>
              <option>Custom</option>
            </select>
            segment:
            <button class="btn btn-link btn-sm text-decoration-none ms-2">
              üìã
            </button>
          </div>

          <!-- Filter builder cards -->
          <div
            class="filter-card px-3 py-2 mb-2 d-flex align-items-center flex-wrap"
          >
            <span class="filter-index">[0]</span>
            <select
              class="form-select form-select-sm mx-1"
              style="width: 110px; display: inline"
            >
              <option>15 min</option>
              <option>1D</option>
              <option>1W</option>
            </select>
            <!-- Clickable indicator -->
            <span class="metric mx-1 indicator-select" style="cursor: pointer"
              >Close</span
            >
            <span class="condition mx-1">Greater than</span>
            <span class="filter-index">[-1]</span>
            <select
              class="form-select form-select-sm mx-1"
              style="width: 110px; display: inline"
            >
              <option>15 min</option>
            </select>
            <!-- Clickable function -->
            <span class="metric mx-1 indicator-select" style="cursor: pointer"
              >Max(20, Close)</span
            >
            <button class="icon-btn" title="Enable/Disable">
              <span>üü¢</span>
            </button>
            <button class="icon-btn" title="Copy"><span>üìã</span></button>
            <button class="icon-btn" title="Remove"><span>‚ùå</span></button>
            <button class="icon-btn" title="Explain"><span>‚ùì</span></button>
          </div>
          <div
            class="filter-card px-3 py-2 mb-2 d-flex align-items-center flex-wrap"
          >
            <span class="filter-index">[0]</span>
            <select
              class="form-select form-select-sm mx-1"
              style="width: 110px; display: inline"
            >
              <option>15 min</option>
            </select>
            <!-- Clickable indicator -->
            <span class="metric mx-1 indicator-select" style="cursor: pointer"
              >Volume</span
            >
            <span class="condition mx-1">Greater than</span>
            <!-- Clickable function -->
            <span class="metric mx-1 indicator-select" style="cursor: pointer"
              >SMA(volume, 20)</span
            >
            <button class="icon-btn" title="Enable/Disable">
              <span>üü¢</span>
            </button>
            <button class="icon-btn" title="Copy"><span>üìã</span></button>
            <button class="icon-btn" title="Remove"><span>‚ùå</span></button>
            <button class="icon-btn" title="Explain"><span>‚ùì</span></button>
          </div>
          <!-- Condition group button row -->
          <div class="d-flex mb-3">
            <button class="btn btn-outline-primary me-2">
              <b>+</b> Add Filter
            </button>
            <button class="btn btn-outline-secondary">
              <b>+</b> Add Group (AND/OR)
            </button>
          </div>

          <!-- Action bar -->
          <div class="action-bar d-flex flex-wrap mb-3 gap-2">
            <button class="btn btn-success"><span>‚ñ∂Ô∏è</span> Run Scan</button>
            <button class="btn btn-outline-success">
              <span>üíæ</span> Save Scan
            </button>
            <button class="btn btn-info text-white">
              <span>üìã</span> Copy Scan
            </button>
            <button class="btn btn-danger"><span>‚ù§Ô∏è</span> Love Scan</button>
            <button class="btn btn-warning">
              <span>üîî</span> Create Alert
            </button>
            <button class="btn btn-dark">
              <span>üñ•Ô∏è</span> Monitor on dashboard
            </button>
            <button
              class="btn btn-primary"
              style="background: #e100ff; border: none"
            >
              <span>üîÑ</span> Backtest Results
            </button>
          </div>

          <!-- Results Table -->
          <div class="card shadow-sm mb-5">
            <div
              class="card-header bg-primary text-white d-flex align-items-center justify-content-between"
            >
              <span>Screener Results</span>
              <button class="btn btn-light btn-sm">Export CSV</button>
            </div>
            <div class="card-body p-0">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Symbol</th>
                    <th>Last Price</th>
                    <th>Change %</th>
                    <th>Volume</th>
                    <th>Matched</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {% for stock in results %}
                  <tr>
                    <td>{{ forloop.counter }}</td>
                    <td><b>{{ stock.symbol }}</b></td>
                    <td>{{ stock.price }}</td>
                    <td>
                      <span
                        class="{% if stock.change > 0 %}text-success{% else %}text-danger{% endif %}"
                      >
                        {{ stock.change }}%
                      </span>
                    </td>
                    <td>{{ stock.volume }}</td>
                    <td>
                      <span class="badge bg-primary">{{ stock.matched }}</span>
                      {% if stock.signal == "Buy" %}
                      <span class="badge badge-buy">Buy</span>
                      {% endif %}
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-secondary">
                        üîç
                      </button>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="7" class="text-center py-4 text-muted">
                      No results found for these conditions.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <!-- Pagination -->
            <div class="card-footer d-flex justify-content-center">
              <nav>
                <ul class="pagination mb-0">
                  <li class="page-item disabled">
                    <a class="page-link" href="#">&laquo;</a>
                  </li>
                  <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                  </li>
                  <li class="page-item"><a class="page-link" href="#">2</a></li>
                  <li class="page-item"><a class="page-link" href="#">3</a></li>
                  <li class="page-item">
                    <a class="page-link" href="#">&raquo;</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Add Button -->
    <button class="floating-btn" title="Add Filter">+</button>

    <!-- Indicator Picker Modal -->
    <div
      class="modal fade"
      id="indicatorModal"
      tabindex="-1"
      aria-labelledby="indicatorModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="indicatorModalLabel">
              Select Indicator or Function
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <input
              type="text"
              id="indicatorSearch"
              class="form-control mb-3"
              placeholder="Search indicator, e.g. RSI, Close, SMA..."
            />
            <ul
              class="list-group"
              id="indicatorList"
              style="max-height: 320px; overflow: auto"
            >
              <!-- Dynamically filled by JS -->
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const allIndicators = [
        "Open",
        "High",
        "Low",
        "Close",
        "Volume",
        "SMA",
        "EMA",
        "VWAP",
        "RSI",
        "MACD",
        "ATR",
        "ADX",
        "EFI",
        "Supertrend",
        "Bollinger Bands",
        "Donchian Channel",
        "Stochastic",
        "ROC",
        "CCI",
        "MFI",
        "OBV",
        "Williams %R",
        "Hull MA",
        "Min(20, Close)",
        "Max(20, Close)",
        "SMA(volume, 20)",
        "SMA(close, 9)",
        "EMA(close, 21)",
      ];

      function renderIndicators(filter = "") {
        const list = document.getElementById("indicatorList");
        list.innerHTML = "";
        allIndicators
          .filter((i) => i.toLowerCase().includes(filter.toLowerCase()))
          .forEach((indicator) => {
            const li = document.createElement("li");
            li.className = "list-group-item list-group-item-action";
            li.style.cursor = "pointer";
            li.textContent = indicator;
            li.onclick = () => selectIndicator(indicator);
            list.appendChild(li);
          });
      }

      function selectIndicator(indicator) {
        if (window._indicatorTarget) {
          window._indicatorTarget.textContent = indicator;
          // Optionally set a hidden input for backend
        }
        var modal = bootstrap.Modal.getInstance(
          document.getElementById("indicatorModal")
        );
        modal.hide();
      }

      document.querySelectorAll(".indicator-select").forEach((el) => {
        el.onclick = function () {
          window._indicatorTarget = this;
          renderIndicators("");
          // Open modal
          let modal = new bootstrap.Modal(
            document.getElementById("indicatorModal")
          );
          modal.show();
        };
      });
      document
        .getElementById("indicatorSearch")
        .addEventListener("input", function () {
          renderIndicators(this.value);
        });
      // Initial render for modal
      renderIndicators("");

      document
        .getElementById("darkSwitch")
        .addEventListener("change", function (e) {
          if (e.target.checked) {
            document.body.style.background = "#18191A";
            document.body.style.color = "#eee";
          } else {
            document.body.style.background = "#f7f9fc";
            document.body.style.color = "#212529";
          }
        });
    </script>
  </body>
</html>
